<div class="forgot-container">
  <div class="forgot-card">
    <div class="forgot-header">
      <h1>Recuperar Senha</h1>
      <p *ngIf="!tokenReceived">Digite seu e-mail para receber o token de recuperação</p>
      <p *ngIf="tokenReceived">Digite sua nova senha</p>
    </div>

    <!-- Formulário de solicitação de token -->
    <form [formGroup]="forgotForm" (ngSubmit)="onRequestToken()" class="forgot-form" *ngIf="!tokenReceived">
      <div class="form-group">
        <label for="email">E-mail</label>
        <input
          type="email"
          id="email"
          formControlName="email"
          placeholder="seu@email.com"
          [class.error]="email?.invalid && email?.touched"
        />
        <span class="error-message" *ngIf="email?.invalid && email?.touched">
          <span *ngIf="email?.errors?.['required']">E-mail é obrigatório</span>
          <span *ngIf="email?.errors?.['email']">E-mail inválido</span>
        </span>
      </div>

      <div class="success-alert" *ngIf="successMessage">
        {{ successMessage }}
      </div>

      <div class="error-alert" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <button type="submit" class="btn-primary" [disabled]="forgotForm.invalid || isLoading">
        <span *ngIf="!isLoading">Enviar Token</span>
        <span *ngIf="isLoading">Enviando...</span>
      </button>

      <div class="back-link">
        <a routerLink="/login">← Voltar para login</a>
      </div>
    </form>

    <!-- Formulário de alteração de senha -->
    <form [formGroup]="changePasswordForm" (ngSubmit)="onChangePassword()" class="forgot-form" *ngIf="tokenReceived">
      <div class="form-group">
        <label for="tokenId">Token de Recuperação</label>
        <input
          type="text"
          id="tokenId"
          formControlName="tokenId"
          placeholder="Cole o token recebido por e-mail"
          [class.error]="tokenId?.invalid && tokenId?.touched"
        />
        <span class="error-message" *ngIf="tokenId?.invalid && tokenId?.touched">
          <span *ngIf="tokenId?.errors?.['required']">Token é obrigatório</span>
        </span>
      </div>

      <div class="form-group">
        <label for="newPassword">Nova Senha</label>
        <input
          type="password"
          id="newPassword"
          formControlName="newPassword"
          placeholder="••••••••"
          [class.error]="newPassword?.invalid && newPassword?.touched"
        />
        <span class="error-message" *ngIf="newPassword?.invalid && newPassword?.touched">
          <span *ngIf="newPassword?.errors?.['required']">Nova senha é obrigatória</span>
          <span *ngIf="newPassword?.errors?.['minlength']">Senha deve ter no mínimo 8 caracteres</span>
        </span>
      </div>

      <div class="success-alert" *ngIf="successMessage">
        {{ successMessage }}
      </div>

      <div class="error-alert" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <button type="submit" class="btn-primary" [disabled]="changePasswordForm.invalid || isLoading">
        <span *ngIf="!isLoading">Alterar Senha</span>
        <span *ngIf="isLoading">Alterando...</span>
      </button>

      <div class="back-link">
        <a routerLink="/login">← Voltar para login</a>
      </div>
    </form>
  </div>
</div>
