<div class="kanban-container">
  <app-service-unavailable 
    *ngIf="serviceUnavailable && !isLoading"
    [message]="errorMessage"
    (retry)="retryLoad()"
  ></app-service-unavailable>

  <div class="loading" *ngIf="isLoading">
    <p>Carregando quadro Kanban...</p>
  </div>

  <div class="kanban-content" *ngIf="!isLoading && !serviceUnavailable">
    <div class="kanban-header">
      <div class="header-left">
        <button class="btn-back" [routerLink]="['/projects', project?.id]">
          â† Voltar
        </button>
        <div class="project-info" *ngIf="project">
          <h1>{{ project.name }}</h1>
          <p>Quadro Kanban</p>
        </div>
      </div>
      <button class="btn-new-task" [routerLink]="['/tasks/new']">
        â• Nova Tarefa
      </button>
    </div>

    <div class="error-alert" *ngIf="errorMessage && !serviceUnavailable">
      {{ errorMessage }}
    </div>

    <div class="kanban-board">
      <!-- TODO Column -->
      <div 
        class="kanban-column todo-column"
        [class.drag-over]="draggedOverColumn === 'TODO'"
        (dragover)="onDragOver($event)"
        (dragenter)="onDragEnter('TODO', $event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop('TODO', $event)">
        <div class="column-header">
          <h2>ğŸ“‹ A Fazer</h2>
          <span class="task-count">{{ todoTasks.length }}</span>
        </div>
        <div class="column-content">
          <div 
            class="kanban-card" 
            *ngFor="let task of todoTasks" 
            draggable="true"
            (dragstart)="onDragStart(task, $event)"
            (dragend)="onDragEnd($event)"
            (click)="$event.preventDefault()"
            [routerLink]="['/tasks', task.id]">
            <div class="card-header">
              <h3>{{ task.title }}</h3>
              <span class="priority-badge" [ngClass]="getPriorityClass(task.priority)">
                {{ getPriorityLabel(task.priority) }}
              </span>
            </div>
            <p class="card-description">{{ task.description }}</p>
            <div class="card-footer">
              <div class="card-info">
                <span class="info-icon">ğŸ‘¤</span>
                <span>{{ task.assignee.email }}</span>
              </div>
              <div class="card-info">
                <span class="info-icon">ğŸ“…</span>
                <span>{{ task.dueDate | date: 'dd/MM' }}</span>
              </div>
            </div>
          </div>
          <div class="empty-column" *ngIf="todoTasks.length === 0">
            <p>Arraste tarefas aqui</p>
          </div>
        </div>
      </div>

      <!-- DOING Column -->
      <div 
        class="kanban-column doing-column"
        [class.drag-over]="draggedOverColumn === 'DOING'"
        (dragover)="onDragOver($event)"
        (dragenter)="onDragEnter('DOING', $event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop('DOING', $event)">
        <div class="column-header">
          <h2>âš™ï¸ Em Progresso</h2>
          <span class="task-count">{{ doingTasks.length }}</span>
        </div>
        <div class="column-content">
          <div 
            class="kanban-card" 
            *ngFor="let task of doingTasks" 
            draggable="true"
            (dragstart)="onDragStart(task, $event)"
            (dragend)="onDragEnd($event)"
            (click)="$event.preventDefault()"
            [routerLink]="['/tasks', task.id]">
            <div class="card-header">
              <h3>{{ task.title }}</h3>
              <span class="priority-badge" [ngClass]="getPriorityClass(task.priority)">
                {{ getPriorityLabel(task.priority) }}
              </span>
            </div>
            <p class="card-description">{{ task.description }}</p>
            <div class="card-footer">
              <div class="card-info">
                <span class="info-icon">ğŸ‘¤</span>
                <span>{{ task.assignee.email }}</span>
              </div>
              <div class="card-info">
                <span class="info-icon">ğŸ“…</span>
                <span>{{ task.dueDate | date: 'dd/MM' }}</span>
              </div>
            </div>
          </div>
          <div class="empty-column" *ngIf="doingTasks.length === 0">
            <p>Arraste tarefas aqui</p>
          </div>
        </div>
      </div>

      <!-- DONE Column -->
      <div 
        class="kanban-column done-column"
        [class.drag-over]="draggedOverColumn === 'DONE'"
        (dragover)="onDragOver($event)"
        (dragenter)="onDragEnter('DONE', $event)"
        (dragleave)="onDragLeave($event)"
        (drop)="onDrop('DONE', $event)">
        <div class="column-header">
          <h2>âœ… ConcluÃ­da</h2>
          <span class="task-count">{{ doneTasks.length }}</span>
        </div>
        <div class="column-content">
          <div 
            class="kanban-card completed" 
            *ngFor="let task of doneTasks" 
            draggable="true"
            (dragstart)="onDragStart(task, $event)"
            (dragend)="onDragEnd($event)"
            (click)="$event.preventDefault()"
            [routerLink]="['/tasks', task.id]">
            <div class="card-header">
              <h3>{{ task.title }}</h3>
              <span class="priority-badge" [ngClass]="getPriorityClass(task.priority)">
                {{ getPriorityLabel(task.priority) }}
              </span>
            </div>
            <p class="card-description">{{ task.description }}</p>
            <div class="card-footer">
              <div class="card-info">
                <span class="info-icon">ğŸ‘¤</span>
                <span>{{ task.assignee.email }}</span>
              </div>
              <div class="card-info">
                <span class="info-icon">ğŸ“…</span>
                <span>{{ task.dueDate | date: 'dd/MM' }}</span>
              </div>
            </div>
          </div>
          <div class="empty-column" *ngIf="doneTasks.length === 0">
            <p>Arraste tarefas aqui</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
